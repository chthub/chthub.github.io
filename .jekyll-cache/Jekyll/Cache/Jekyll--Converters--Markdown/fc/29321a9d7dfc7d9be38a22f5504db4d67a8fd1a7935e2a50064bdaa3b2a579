I"Ä%<h1 id="prototypical-contrastive-learning-of-unsupervised-representations">Prototypical Contrastive Learning of unsupervised representations</h1>

<p>ICLR 2021</p>

<p>è¿™ç¯‡æ–‡ç« æå‡ºäº†Prototypical Contrastive Learning ï¼ˆPCLï¼‰ï¼Œè¿™æ˜¯ä¸€ç§æ— ç›‘ç£çš„è¡¨ç¤ºå­¦ä¹ ç®—æ³•ï¼Œå°†å¯¹æ¯”å­¦ä¹ å’Œèšç±»è”ç³»åœ¨ä¸€èµ·ã€‚</p>

<p>ä½œè€…è®¤ä¸ºinstance-wise contrastive learningå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>

<ol>
  <li>å®ä¾‹ä¹‹é—´çš„åˆ¤åˆ«åªåˆ©ç”¨åˆ°äº†ä½ä»·çš„å›¾åƒä¹‹é—´çš„å·®å¼‚ï¼Œè€Œæ²¡æœ‰è€ƒè™‘åˆ°é«˜é˜¶çš„è¯­ä¹‰å…³ç³»</li>
  <li>åªè¦æ±‚æ­£è´Ÿæ ·æœ¬è¿œç¦»ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°è´Ÿæ ·æœ¬å†…éƒ¨çš„ç›¸ä¼¼æ€§ã€‚ä¸å¯é¿å…åœ°ä¼šæœ‰è´Ÿæ ·æœ¬å¯¹å…·æœ‰ç›¸ä¼¼çš„è¯­ä¹‰ï¼Œæœ¬åº”åœ¨è¡¨å¾ç©ºé—´ä¸­ç›¸è·æ›´è¿‘ï¼Œä½†è¢«å¯¹æ¯”æŸå¤±æ‹‰è¿œäº†ã€‚è¿™æ˜¯ä¸€ç§class collisioné—®é¢˜ã€‚</li>
</ol>

<h2 id="formulation">Formulation</h2>

<p>æœ€ç»ˆçš„ç›®æ ‡æ˜¯æ‰¾åˆ°èƒ½ä½¿è§‚å¯Ÿåˆ°çš„$n$ä¸ªæ ·æœ¬çš„å¯¹æ•°ä¼¼ç„¶æœ€å¤§åŒ–çš„å‚æ•°$\theta$ï¼š</p>

\[\theta^*=\underset{\theta}{\arg \max } \sum_{i=1}^n \log p\left(x_i ; \theta\right)\]

<p>å‡è®¾è§‚æµ‹åˆ°çš„æ•°æ®é›†æ˜¯ $\left\lbrace x_i\right\rbrace_{i=1}^n$ï¼Œå¯¹åº”çš„åŸå‹ï¼ˆprototypeï¼‰æ˜¯éšå˜é‡ $C=\left\lbrace c_i\right\rbrace_{i=1}^k$ ï¼Œåˆ™ä»£å…¥$C$ä¸Šå¼åŒ–ä¸ºï¼š</p>

\[\theta^*=\underset{\theta}{\arg \max } \sum_{i=1}^n \log p\left(x_i ; \theta\right)=\underset{\theta}{\arg \max } \sum_{i=1}^n \log \sum_{c_i \in C} p\left(x_i, c_i ; \theta\right)\]

<p>ç°åœ¨è¿˜æ˜¯å¾ˆéš¾ä¼˜åŒ–ï¼Œåˆ©ç”¨Jensenâ€™s inequalityï¼Œæœ€å¤§åŒ–ä¸Šå¼å¯ä»¥è½¬åŒ–ä¸ºæœ€å¤§åŒ–ä¸Šå¼çš„ä¸‹ç•Œï¼š</p>

\[\begin{align}
\sum_{c_i \in C} Q\left(c_i\right)&amp;=1 \\
\sum_{i=1}^n \log \sum_{c_i \in C} p\left(x_i, c_i ; \theta\right) &amp;=\sum_{i=1}^n \log \sum_{c_i \in C} Q\left(c_i\right) \frac{p\left(x_i, c_i ; \theta\right)}{Q\left(c_i\right)}\\
&amp; \geq \sum_{i=1}^n \sum_{c_i \in C} Q\left(c_i\right) \log \frac{p\left(x_i, c_i ; \theta\right)}{Q\left(c_i\right)}\\
&amp;=\sum_{i=1}^n \sum_{c_i \in C} Q\left(c_i\right) \log p\left(x_i, c_i ; \theta\right)-\underbrace{\sum_{i=1}^n \sum_{c_i \in C} Q\left(c_i\right) \log Q\left(c_i\right)}_{\text{constant}}
\end{align}\]

<p>ç”±äºç¬¬äºŒé¡¹ä¸ºå¸¸æ•°ï¼Œæ‰€ä»¥åªè¦æœ€å¤§åŒ–ç¬¬ä¸€é¡¹å°±è¡Œäº†ï¼š</p>

\[\theta^*=\underset{\theta}{\arg \max }\sum_{i=1}^n \sum_{c_i \in C} Q\left(c_i\right) \log p\left(x_i, c_i ; \theta\right)\]

<p>å½“$\frac{p\left(x_i, c_i ; \theta\right)}{Q\left(c_i\right)}$ä¸ºå¸¸æ•°æ—¶ç­‰å·æˆç«‹ï¼Œæœ‰ï¼š</p>

\[Q\left(c_i\right)=\frac{p\left(x_i, c_i ; \theta\right)}{Const}\\
\sum_{c_i \in C}Q\left(c_i\right)=1=\frac{1}{Const}\sum_{c_i \in C}p\left(x_i, c_i ; \theta\right)\\
Const=\sum_{c_i \in C}p\left(x_i, c_i ; \theta\right)\]

<p>æ‰€ä»¥æ­¤æ—¶ä»£å…¥$Const$å¯ä»¥å‘ç°$Q(c_i)$å°±æ˜¯åœ¨$x_i$æ¡ä»¶ä¸‹çš„åéªŒæ¦‚ç‡$p(c_i;x_i,\theta)$ï¼š</p>

\[Q\left(c_i\right)=\frac{p\left(x_i, c_i ; \theta\right)}{\sum_{c_i \in C} p\left(x_i, c_i ; \theta\right)}=\frac{p\left(x_i, c_i ; \theta\right)}{p\left(x_i ; \theta\right)}=p\left(c_i ; x_i, \theta\right)\]

<p>ç„¶åä½¿ç”¨EMç®—æ³•æ±‚è§£ã€‚</p>

<p>åœ¨E-stepï¼Œä¼°è®¡$Q(c_i)$ä¹Ÿå³$p\left(c_i ; x_i, \theta\right)$ã€‚å¯¹ç‰¹å¾$v_i^{\prime}=f_{\theta^{\prime}}\left(x_i\right)$ ä½¿ç”¨ $k$-means èšç±»å½¢æˆ$k$ä¸ªç°‡ï¼Œè¿™é‡Œçš„$f_{\thetaâ€™}$æ˜¯åŠ¨é‡ç¼–ç å™¨ã€‚åŸå‹$c_i$å®šä¹‰ä¸ºç¬¬$i$ä¸ªç°‡çš„ç°‡å¿ƒã€‚$Q(c_i)$å®šä¹‰å¦‚ä¸‹ï¼š</p>

\[Q(c_i)=p\left(c_i ; x_i, \theta\right)=\mathbb{1}\left(x_i \in c_i\right)=\left\lbrace 
\begin{aligned}
1, x_i\in c_i\\
0, x_i \notin c_i
\end{aligned}
\right.\]

<p>åœ¨M-stepè¿›è¡Œæœ€å¤§åŒ–ï¼š</p>

\[\begin{aligned}
\underset{\theta}{\arg \max }\sum_{i=1}^n \sum_{c_i \in C} Q\left(c_i\right) \log p\left(x_i, c_i ; \theta\right) &amp;=\sum_{i=1}^n \sum_{c_i \in C} p\left(c_i ; x_i, \theta\right) \log p\left(x_i, c_i ; \theta\right) \\
&amp;=\sum_{i=1}^n \sum_{c_i \in C} \mathbb{1}\left(x_i \in c_i\right) \log p\left(x_i, c_i ; \theta\right)\\
&amp;=\sum_{i=1}^n \sum_{c_i \in C} \mathbb{1}\left(x_i \in c_i\right) \log p\left(x_i ; c_i, \theta\right) \underbrace{p\left(c_i ; \theta\right)}_{\text{uniform prior}} \\
&amp;=\sum_{i=1}^n \sum_{c_i \in C} \mathbb{1}\left(x_i \in c_i\right) \log\frac{1}{k} \cdot p\left(x_i ; c_i, \theta\right)
\end{aligned}\]

<p>å‡è®¾åŸå‹$c_i$å‘¨å›´çš„æ ·æœ¬ç‚¹æœä»å„å‘åŒæ€§çš„é«˜æ–¯åˆ†å¸ƒï¼ˆisotropic Gaussianï¼‰ï¼š</p>

\[p\left(x_i ; c_i, \theta\right)=\exp \left(\frac{-\left(v_i-c_s\right)^2}{2 \sigma_s^2}\right) / \sum_{j=1}^k \exp \left(\frac{-\left(v_i-c_j\right)^2}{2 \sigma_j^2}\right)\]

<p>è¿™é‡Œ$v_i=f_\theta\left(x_i\right)$ ï¼Œ$x_i \in c_s$ã€‚æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª$c_s$å’Œ$c_i$ä¹‹é—´çš„å·®å¼‚ï¼Œå› ä¸ºè®¡ç®—çš„æ—¶å€™æ˜¯å¯¹æ‰€æœ‰çš„æ ·æœ¬ç‚¹å’Œæ‰€æœ‰åŸå‹ä¹‹é—´è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥è¿™é‡Œçš„$c_s$ä¸“æŒ‡$x_i$æ‰€å±äºçš„é‚£ä¸ªåŸå‹ã€‚æ­¤å¤–ï¼Œè¿™é‡Œçš„æ¯ä¸€ä¸ªç°‡çš„æ–¹å·®$\sigma_j$ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯$v_i$å’Œè·ç¦»$v_i$æ¯”è¾ƒè¿œçš„åŸå‹$c_i$ä¹‹é—´è®¡ç®—å¾—åˆ°çš„ç›¸ä¼¼æ€§å¾ˆä½ï¼Œåœ¨åˆ†æ¯ä¸­åªå è¾ƒå°çš„æ¯”é‡ï¼Œæ‰€ä»¥è¿™ä¸ªå¼å­ä¹Ÿå¯ä»¥è¿‘ä¼¼çœ‹ä½œæ˜¯åªè€ƒè™‘äº†è·ç¦»$v_i$æœ€è¿‘çš„å‡ ä¸ªç°‡å¿ƒåçš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>

<p>æœ€ç»ˆåŒ–ç®€ä¹‹åçš„ç›®æ ‡æ˜¯è¦æœ€å°åŒ–ä¸‹å¼ï¼š</p>

\[\theta^*=\underset{\theta}{\arg \min } \sum_{i=1}^n-\log \frac{\exp \left(v_i \cdot c_s / \phi_s\right)}{\sum_{j=1}^k \exp \left(v_i \cdot c_j / \phi_j\right)}\]

<p>è¿™é‡Œ$\phi \propto \sigma^2$è¡¨ç¤ºæ ·æœ¬ç‚¹åœ¨åŸå‹å‘¨å›´åˆ†å¸ƒçš„èšé›†ç¨‹åº¦ã€‚æ³¨æ„åˆ°æœ€ç»ˆçš„ä¼˜åŒ–ç›®æ ‡å’ŒInfoNCEç›¸ä¼¼ï¼Œæ‰€ä»¥è¯´InfoNCEä¹Ÿå¯ä»¥è§£é‡Šæˆä¸€ç§æå¤§ä¼¼ç„¶ä¼°è®¡çš„ç‰¹æ®Šæƒ…å†µã€‚</p>

<p>æœ€ç»ˆçš„æŸå¤±å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>

\[\mathcal{L}_{\text {ProtoNCE }}=\sum_{i=1}^n-\left(\log \frac{\exp \left(v_i \cdot v_i^{\prime} / \tau\right)}{\sum_{j=0}^r \exp \left(v_i \cdot v_j^{\prime} / \tau\right)}+\frac{1}{M} \sum_{m=1}^M \log \frac{\exp \left(v_i \cdot c_s^m / \phi_s^m\right)}{\sum_{j=0}^r \exp \left(v_i \cdot c_j^m / \phi_j^m\right)}\right)\]

<p>æŸå¤±å‡½æ•°çš„ç¬¬ä¸€é¡¹ä½œè€…æŠŠInfoNCEåŠ å…¥äº†è¿›æ¥ï¼Œè¿™é‡Œ$v_i^\prime$æ˜¯å’Œ$v_i$å±äºç›¸åŒç°‡çš„å¢å¹¿æ ·æœ¬ï¼Œ$r$æ˜¯è´Ÿæ ·æœ¬çš„æ•°é‡ã€‚æ€»å…±è¿›è¡Œ$M$æ¬¡èšç±»ï¼Œæ¯æ¬¡çš„ç±»ç°‡æ•°éƒ½ä¸ä¸€æ ·$K=\left\lbrace k_m\right\rbrace_{m=1}^M$ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æå‡åŸå‹çš„æ¦‚ç‡ä¼°è®¡çš„é²æ£’æ€§ï¼Œå¹¶èƒ½ç¼–ç åˆ†å±‚çš„ç»“æ„ã€‚</p>

<p>$\phi$è¡¨ç¤ºæ ·æœ¬ç‚¹çš„é›†ä¸­ç¨‹åº¦ï¼Œä½¿ç”¨åŒä¸€ç°‡çš„åŠ¨é‡ç‰¹å¾$\left\lbrace v_z^{\prime}\right\rbrace_{z=1}^Z$ä¼°è®¡$\phi$ã€‚$\phi$è¶Šå°ï¼Œè¡¨æ˜èšé›†ç¨‹åº¦è¶Šå¤§ã€‚å¯¹äºè¾ƒå°çš„$\phi$ï¼Œåº”è¯¥æ»¡è¶³ï¼š</p>

<ol>
  <li>$vâ€™_z$å’Œ$c$ä¹‹é—´çš„å¹³å‡è·ç¦»å°</li>
  <li>ç°‡åŒ…å«çš„ç‰¹å¾ç‚¹å¤šï¼ˆ$Z$æ¯”è¾ƒå¤§ï¼‰</li>
</ol>

<p>æ‰€ä»¥ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>

\[\phi=\frac{\sum_{z=1}^Z\left\|v_z^{\prime}-c\right\|_2}{Z \log (Z+\alpha)}\]

<p>$\alpha$æ˜¯å¹³æ»‘ç³»æ•°ï¼Œç¡®ä¿$\phi$ä¸ä¼šå¤ªå¤§ã€‚$\tau$é€šè¿‡åœ¨åŸå‹é›†åˆ$C^m$ä¸Šå¯¹$\phi$å½’ä¸€åŒ–å¹¶å–å‡å€¼å¾—åˆ°ã€‚</p>

<p>å¯¹äºæ¾æ•£çš„ç°‡ï¼ˆ$\phi$è¾ƒå¤§ï¼‰æ¥è¯´ï¼ŒProtoNCEä¼šæ‹‰è¿‘æ ·æœ¬embeddingå’ŒåŸå‹ä¹‹é—´è·ç¦»ã€‚å¯¹äºç´§å‡‘çš„ç°‡ï¼ˆ$\phi$è¾ƒå°ï¼‰æ¥è¯´ï¼ŒProtoNCEæ›´å°‘åœ°ä½¿æ ·æœ¬çš„embeddingæ¥è¿‘åŸå‹ã€‚æ‰€ä»¥ProtoNCEå°†ä¼šäº§ç”Ÿæ›´åŠ å¹³è¡¡çš„ç°‡ï¼Œä¸”ç°‡çš„èšé›†ç¨‹åº¦éƒ½è¾ƒä¸ºç›¸ä¼¼ã€‚è¿™è¿˜é˜»æ­¢äº†æ‰€æœ‰embeddingéƒ½åå¡Œåˆ°åŒä¸€ä¸ªç°‡çš„è¿™ç§å¹³å‡¡è§£ï¼ˆDeepClusteré‡Œé¢é€šè¿‡æ•°æ®é‡é‡‡æ ·è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¼•å…¥å¯¹èšé›†ç¨‹åº¦çš„ä¼°è®¡ä½¿å¾—ç°‡çš„å¤§å°åˆ†å¸ƒæ›´ä¸ºé›†ä¸­ï¼Œå›ºå®šçš„èšé›†ç¨‹åº¦çš„ç°‡çš„å¤§å°æ›´åˆ†æ•£ã€‚</p>

<p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911003937990.png" alt="image-20220911003937990" style="zoom:50%;" /></p>

<h2 id="äº’ä¿¡æ¯åˆ†æ">äº’ä¿¡æ¯åˆ†æ</h2>

<p>æˆ‘ä»¬å·²ç»çŸ¥é“æœ€å°åŒ–InfoNCEç­‰ä»·äºæœ€å¤§åŒ–$V$å’Œ$Vâ€™$ä¹‹é—´äº’ä¿¡æ¯ã€‚ç›¸ä¼¼åœ°ï¼Œæœ€å°åŒ–æœ¬æ–‡æåˆ°çš„ProtoNCEç­‰ä»·äºæœ€å¤§åŒ–$V$å’Œ$\lbrace Vâ€™,C^1,\dots,C^M\rbrace$ä¹‹é—´çš„äº’ä¿¡æ¯ã€‚è¿™å¸¦æ¥çš„ä¼˜åŠ¿æœ‰ä¸¤æ–¹é¢ï¼š</p>

<ol>
  <li>
    <p>è¿™ç§æƒ…å†µä¸‹ç¼–ç å™¨èƒ½å¤Ÿå­¦ä¹ åˆ°åŸå‹ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œè¿™å°±å¿½ç•¥äº†åŸå‹å†…éƒ¨çš„å™ªå£°ï¼Œä½¿å¾—è¿™ç§å…±äº«çš„ä¿¡æ¯æ›´å¯èƒ½æ•è·é«˜é˜¶çš„è¯­ä¹‰çŸ¥è¯†ã€‚</p>
  </li>
  <li>
    <p>å’Œæ ·æœ¬ç‰¹å¾ç›¸æ¯”ï¼ŒåŸå‹å’Œç±»åˆ«æ ‡ç­¾ä¹‹é—´çš„äº’ä¿¡æ¯æ›´å¤§ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œembeddingå’Œç±»åˆ«æ ‡ç­¾ä¹‹é—´çš„äº’ä¿¡æ¯æ˜¯ä¸æ–­å¢åŠ çš„ã€‚ä½†æ˜¯å¯ä»¥çœ‹åˆ°åŸå‹å’Œç±»åˆ«æ ‡ç­¾ä¹‹é—´çš„äº’ä¿¡æ¯æ˜¯æœ€å¤§çš„ï¼Œå•çº¯çš„æ ·æœ¬ç‰¹å¾å’Œç±»åˆ«æ ‡ç­¾çš„äº’ä¿¡æ¯æ˜¯æ¯”è¾ƒå°çš„ã€‚ProtoNCEå¸¦æ¥çš„äº’ä¿¡æ¯å¢ç›Šæ˜¯å¤§äºInfoNCEçš„ã€‚è¿™è¯´æ˜åŸå‹ç¡®å®æ˜¯å­¦åˆ°äº†æ›´ä¸°å¯Œçš„è¯­ä¹‰ã€‚</p>

    <p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911005020940.png" alt="image-20220911005020940" style="zoom:50%;" /></p>

    <h2 id="å®éªŒ">å®éªŒ</h2>

    <p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911010552285.png" alt="image-20220911010552285" style="zoom:50%;" /></p>

    <p>è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†è¯¥ç®—æ³•å¯ä»¥å­¦åˆ°ä¸åŒç²’åº¦çš„é«˜é˜¶è¯­ä¹‰ã€‚è¿™é‡Œçš„ä¸åŒç²’åº¦æ˜¯ç”±èšç±»æ—¶é¢„å…ˆæŒ‡å®šçš„ç±»ç°‡æ•°$k$æ‰€å†³å®šçš„ï¼Œ$k$è¶Šå¤§ï¼Œç²’åº¦è¶Šç»†ï¼Œåä¹‹ç²’åº¦åˆ™ç²—ã€‚ä¸‹å›¾ä¸­çš„ç»¿è‰²å’Œé»„è‰²ä¹Ÿæ˜¯è¡¨ç¤ºä¸åŒçš„ç²’åº¦ï¼Œä½†å…·æœ‰ç›¸ä¼¼ä¹Ÿæœ‰å·®åˆ«çš„è¯­ä¹‰å…³ç³»ã€‚</p>

    <p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911010951177.png" alt="image-20220911010951177" style="zoom:50%;" /></p>

    <p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911011019443.png" alt="image-20220911011019443" style="zoom:50%;" /></p>

    <h2 id="ä¼ªä»£ç ">ä¼ªä»£ç </h2>

    <p><img src="https://raw.githubusercontent.com/chthub/everydaypaper/main/imgs/image-20220911005531307.png" alt="image-20220911005531307" /></p>
  </li>
</ol>

:ET